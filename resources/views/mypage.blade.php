@extends('layouts.app')
@section('title', 'マイページ')
@section('content')

<main>

    <div style="display: flex; align-items: center; gap: 12px;">
        <div style="position: relative; width: 150px; height: 150px; display: flex; align-items: center; justify-content: center;">
            <svg style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"><use xlink:href="#medal"></use></svg>
            <span class="mypage_numeral" style="position: relative; margin-top: -20px; font-size: 1.5em; color: var(--bg-color);">{{$level}}</span>
        </div>
        <div>
            <div style="font-weight: bold;">Lv.{{$level}}</div>
            <div style="font-size: 2em; font-weight: 900;">{{ Auth::user()->name }}</div>
        </div>
    </div>

    @php
        $total = 2+5*($level-1);         // レベルアップに必要な合計pt
        $current = $totalPoints;       // 現在のpt
        $needed = $total - $current; // あと何ptか
        
        $percent = ($current / $total) * 100; // 達成率(%)
        $circumference = 180 * M_PI; // 円周
        $dasharray = ($circumference * $percent) / 100; // progressの長さ
        $angle = ($dasharray / $circumference) * 360;   // 回転角度
    @endphp

    <div style="background-color: var(--base-color); padding: 20px;">

        <div class="maypage_list_container">
            <div>
                <div class="maypage_list">
                    <div>ゴール達成数</div>
                    <div style="text-align: center;">
                        <span class="mypage_numeral">{{$completedGoalsCount}}</span>
                        個
                    </div>
                </div>
                <a href="{{ route('chat_test') }}">AIと「ゴール」を見つける</a>
            </div>
                
            <div>
                <div class="maypage_list">
                    タスク達成数
                    <div style="text-align: center;">
                        <span class="mypage_numeral">{{$completedTasksCount}}</span>
                        個
                    </div>
                </div>
                <a href="{{ route('task') }}">「タスク」を確認する</a>
            </div>

            <div>
                <div class="maypage_list">
                    現在のポイント数
                    <div style="text-align: center;">
                        <span class="mypage_numeral">{{ $current }}</span>
                        pt
                    </div>
                </div>
                <a href="{{ route('faq') }}">ポイントの貯め方を確認する</a>
            </div>

        </div>

        <div class="mypage_needed_container" style="--circumference: {{ round($circumference, 5) }}; --dash-size: {{ $dasharray }}; --cap-angle: {{ $angle }}deg;">

            <div style="display: flex; flex-direction: column; align-items: center;">
                <p>レベルアップ条件：{{ $total }}pt</p>
                <div class="mypage_pie_container">
                    <svg class="pie" width="280" height="280">
                        <circle class="base" cx="140" cy="140" r="90"></circle>
                        <circle class="progress" cx="140" cy="140" r="90"></circle>
                        <rect class="cap start" x="215" y="139" width="30" height="2"></rect>
                        <rect class="cap end" x="215" y="139" width="30" height="2"></rect>
                    </svg>

                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: var(--accent-color); font-family: M PLUS Rounded 1c, sans-serif; font-weight: 900;">
                        <span class="mypage_numeral" style="font-size: 1.8em;">{{ min(100, round($percent)) }}</span>
                        %
                    </div>
                </div>
            </div>

            <div class="mypage_needed">
                <div style="font-weight: bold;">Lv.{{$level+1}}まであと</div>
                <div class="mypage_needed_numeral">
                    <span class="mypage_numeral">{{ $needed }}</span>
                    pt
                </div>
            </div>
        </div>
    </div>

</main>

@endsection
@push('scripts')
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="medal" viewBox="0 0 512 512">
        <path d="M0 0 C8.1240211 3.01968991 16.59451544 5.17415349 25.17407227 2.76977539 C26.16922852 2.49133789 27.16438477 2.21290039 28.18969727 1.92602539 C31.98875675 0.6656739 35.6973718 -0.77295225 39.42407227 -2.23022461 C48.84003147 -5.88881164 58.72463359 -9.13868271 68.48657227 -5.16772461 C78.13685858 0.06435833 83.75247106 10.09429929 89.48657227 19.08227539 C97.64618688 31.32169731 107.14194407 35.21901595 120.88500977 39.07055664 C141.48377211 44.85309807 141.48377211 44.85309807 147.48657227 54.83227539 C149.28887549 60.10671161 149.7674655 64.71057298 149.76000977 70.25805664 C149.78030278 71.87590205 149.80115364 73.49374054 149.82250977 75.11157227 C149.84503101 77.62587367 149.86156088 80.13989944 149.86743164 82.65429688 C149.91911901 95.82553109 150.99073631 105.47727405 159.79907227 115.83227539 C160.77608718 117.0313688 161.75134338 118.23189731 162.72485352 119.43383789 C163.19616699 120.01037109 163.66748047 120.5869043 164.15307617 121.1809082 C170.57610684 129.13502381 176.29415881 136.88032813 175.82250977 147.49243164 C174.4202947 157.25902262 168.42791274 164.30072392 162.48657227 171.83227539 C161.03631828 173.71837021 159.59818246 175.61386342 158.17407227 177.51977539 C157.25174805 178.73213867 157.25174805 178.73213867 156.31079102 179.96899414 C155.40780273 181.38631836 155.40780273 181.38631836 154.48657227 182.83227539 C153.94154053 183.65828247 153.94154053 183.65828247 153.38549805 184.50097656 C148.58751243 193.15079101 149.96123431 203.75849539 149.99584961 213.33691406 C150.01669786 235.09623499 150.01669786 235.09623499 142.73657227 242.70727539 C134.76379676 247.92024399 126.65395538 250.41167423 117.48657227 252.83227539 C117.48657227 256.41352894 118.45647988 258.25751723 119.98657227 261.49243164 C120.53635742 262.66225586 121.08614258 263.83208008 121.65258789 265.03735352 C122.26387236 266.32318156 122.87520174 267.60898826 123.48657227 268.89477539 C124.11409039 270.22588939 124.74103304 271.55727482 125.36743164 272.88891602 C127.04938482 276.46108383 128.73802304 280.0300492 130.4284668 283.59820557 C133.27581279 289.61005406 136.11499324 295.62575558 138.95239258 301.64230347 C139.95871804 303.77329148 140.96849948 305.90261348 141.97875977 308.03173828 C145.03811073 314.49296824 148.05627328 320.97355431 150.94750977 327.51196289 C151.43525879 328.60750488 151.92300781 329.70304687 152.42553711 330.83178711 C153.92229923 335.06446232 154.11642271 338.62800209 152.48657227 342.83227539 C150.24067901 345.82679973 149.03787859 346.64850661 145.48657227 347.83227539 C136.13368935 347.91073917 126.85564152 345.94855075 117.71020508 344.20458984 C106.26466021 342.01577937 106.26466021 342.01577937 95.40063477 345.29711914 C91.2838134 348.59897791 89.04305083 353.3056069 86.48657227 357.83227539 C84.86869807 360.65018327 83.24228009 363.4627394 81.60644531 366.27026367 C80.45752144 368.24531316 79.31934736 370.22666154 78.19287109 372.21459961 C72.94625267 381.28491749 72.94625267 381.28491749 68.48657227 383.83227539 C65.98657227 384.43383789 65.98657227 384.43383789 63.48657227 384.45727539 C62.66157227 384.49079102 61.83657227 384.52430664 60.98657227 384.55883789 C57.16601774 383.44848923 55.52820337 381.06808212 53.48657227 377.83227539 C51.15690298 373.53409639 49.06420888 369.13098994 46.98657227 364.70727539 C46.37299294 363.41670813 45.75880587 362.12642966 45.14404297 360.83642578 C43.24459014 356.8414076 41.36407104 352.83764733 39.48657227 348.83227539 C38.89592571 347.57462049 38.3052684 346.31697063 37.71459961 345.05932617 C31.72653234 332.29615648 25.81989356 319.49681118 20.11230469 306.60546875 C18.69990501 302.96387346 18.69990501 302.96387346 16.48657227 299.83227539 C13.58851869 305.91455325 10.69288688 311.99797958 7.79907227 318.08227539 C7.36784058 318.98886902 6.93660889 319.89546265 6.49230957 320.82952881 C1.01651794 332.34612323 -4.41705281 343.88005356 -9.76342773 355.45727539 C-16.68882435 370.41493084 -16.68882435 370.41493084 -19.63842773 376.45727539 C-20.13600586 377.48079102 -20.63358398 378.50430664 -21.14624023 379.55883789 C-22.51342773 381.83227539 -22.51342773 381.83227539 -25.51342773 383.83227539 C-27.81811523 384.16821289 -27.81811523 384.16821289 -30.38842773 384.20727539 C-31.23147461 384.23563477 -32.07452148 384.26399414 -32.94311523 384.29321289 C-36.41452693 383.67068009 -37.91400649 382.20006994 -40.51342773 379.83227539 C-42.36279297 377.1184082 -42.36279297 377.1184082 -44.07202148 374.03540039 C-44.7055957 372.91133789 -45.33916992 371.78727539 -45.99194336 370.62915039 C-46.64572047 369.44729115 -47.29871096 368.26499643 -47.95092773 367.08227539 C-54.54063351 353.82588299 -54.54063351 353.82588299 -64.88842773 343.83227539 C-73.69477568 341.40293803 -82.28474067 343.7001935 -91.07592773 345.33227539 C-93.63869963 345.80662537 -96.2024818 346.27555568 -98.76733398 346.73852539 C-100.45838257 347.05273438 -100.45838257 347.05273438 -102.18359375 347.37329102 C-107.29796045 348.07825541 -111.16195318 348.52076243 -115.82592773 346.14477539 C-118.70735099 343.66541119 -119.7412052 342.52178303 -120.51342773 338.83227539 C-120.22504628 331.69964085 -116.99787649 325.86702675 -113.95092773 319.51977539 C-113.37361854 318.29973865 -112.79722441 317.07926855 -112.22167969 315.85839844 C-110.9845383 313.23768265 -109.74210219 310.61956876 -108.49584961 308.00317383 C-106.44045914 303.68470802 -104.40504919 299.35698388 -102.37280273 295.02758789 C-99.69837273 289.33170586 -97.02108073 283.6372027 -94.33764648 277.94555664 C-90.39202067 269.57644767 -86.45229706 261.20456602 -82.51342773 252.83227539 C-83.36799561 252.6739624 -84.22256348 252.51564941 -85.10302734 252.35253906 C-94.3767423 250.57208723 -104.8915325 247.4786251 -111.72827148 240.60571289 C-115.84296175 234.21308687 -116.94455943 228.48063892 -116.88452148 221.05493164 C-116.90190093 219.39021601 -116.91948535 217.72550251 -116.93725586 216.06079102 C-116.94731074 213.47619695 -116.95092573 210.89174171 -116.94921875 208.30712891 C-116.65381936 194.97080424 -116.65381936 194.97080424 -121.51342773 182.83227539 C-122.41641602 181.41495117 -122.41641602 181.41495117 -123.33764648 179.96899414 C-123.9525293 179.16075195 -124.56741211 178.35250977 -125.20092773 177.51977539 C-125.89057617 176.59680664 -126.58022461 175.67383789 -127.29077148 174.72290039 C-128.81205934 172.7444241 -130.3466078 170.7760931 -131.89233398 168.81665039 C-137.9834329 160.98953811 -143.44067452 153.37322268 -142.89624023 143.04711914 C-141.35588248 134.13504927 -135.40908347 126.35492955 -129.82202148 119.50415039 C-129.09897827 118.61119263 -129.09897827 118.61119263 -128.36132812 117.70019531 C-127.41016826 116.53430319 -126.44779734 115.37742775 -125.47216797 114.23193359 C-116.78092042 103.61479338 -116.94222785 92.81427318 -116.95092773 79.70727539 C-116.94729984 77.14598077 -116.93758147 74.58535669 -116.91017151 72.02420044 C-116.89359983 70.44150146 -116.89033343 68.85858196 -116.90318298 67.27584839 C-116.8404338 60.6402257 -115.4126258 54.03070193 -110.57592773 49.14477539 C-102.79252202 42.03678918 -91.63373804 39.81908808 -81.71972656 37.0625 C-68.12598082 33.19717714 -61.01404136 26.777432 -53.51342773 14.89477539 C-42.84030497 -1.92823496 -42.84030497 -1.92823496 -33.51342773 -6.16772461 C-21.77449545 -8.71966641 -10.83725262 -4.14675367 0 0 Z " fill="currentColor" transform="translate(239.513427734375,67.167724609375)"/>
    </symbol>
</svg>
@endpush